# 2019.12.23 

# JDBC

> 자바로 데이터베이스를 연결하는 기술

## 1. 드라이버 로딩

> 어떤 DBMS를 사용하는지 인식시키는 작업
>
> 오라클에서 제공해준 드라이버 파일(oracle.jdbc.driver.OracleDriver)을 JVM의 메모리에 로딩시키는 작업을 하는 단계

* 여기서 메모리에 올리는 작업은 heap메모리에 올리는 작업이 아니다. java로 클래스를 만들면 클래스의 내용이 static영역에 올라간다. 

  그러나 외부 라이브러리로 불러온 **OracleDriver정보는 JVM이 모르기 때문에 클래스 정보를 로드해야 한다.** 

  그 작업이 **Class의 forName메서드**를 통해 **핵심 클래스를 메모리에 올리는 것**이다.

* **OracleDriver(ojdbc6.jar)**

  : **핵심 클래스**로 소스에 접근할 수 없고 역컴파일 또한 불가능하다.

```java
Class.forName("oracle.jdbc.driver.OracleDriver");
			   ------------------
                   //패키지		------------
                   					//클래스
```

## 2. 커넥션설정하기

> DBMS에 접속하기 위해서 DriverManager의 getConnection이라는 static 메서드를 제공
>
> getConnection 메서드는 매개변수로 전달하는 **접속 문자열을 보며 어떤 DBMS에 연결해야 하는지 판단**한다.
>
> **어떤 DBMS에 접속했냐**에 따라 모두 **다른 객체를 리턴**
>
> **DBMS에 접속하기 위해**서는 **ip 정보, port정보, 계정, 패스워드가 필요**하다.

* **jdbc:oracle:thin:@ip:port:데이터베이스 서비스 명**

  ex) jdbc:oracle:thin:@127.0.0.1(or localhost):1521:xe

  => jdbc:oracle:thin은 oracle 내부에서 통신하는 규칙명

  => 127.0.0.1과 localhost는 모두 현재 작업 중인 자기 pc를 나타낸다.

```java
//연결 문자열 - 어떤 DBMS를 쓰느냐에 따라 형식이 달라진다.
String url = "jdbc:oracle:thin:@localhost:1521:xe";
//접속계정
String user = "scott";
//접속계정 패스워드
String password = "tiger";

Connection con = DriverManager.getConnection(url,user,password);
// getConnection 메서드가 리턴하는 객체는 Connection 객체에 종속적이다.
// 그래서 위처럼 부모형 참조변수에 객체를 받은 것이다.
// 즉, 실제 실행되는 API는 ojdbc6.jar에 있는 내부가 숨겨진 .class 파일들이다.
```

다시 말해서 java.sql.Connection을 implements 하고 있는 **oracle.jdbc.OracleConnection에 구현부가 숨겨져 있는 것**이다.

※ OracleConnection.class 파일의 내용을 확인하면 알기 쉽다.

## 3. Statement객체 생성하기

> SQL문을 실행하기 위한 역할을 담당하는 클래스는 Statement
>
> Statement 객체는 Connection 객체의 메서드를 이용하여 생성하도록 설계되어 있음
>
> 이것 또한 **연결된 DBMS에 따라 다른 Statement 객체가 생성**된다!

```java
Statement stmt = con.createStatement();
// 마찬가지로 java.sql.Statement를 implements 하고 있는 
// oracle.jdbc.Statement에 구현부가 숨겨져 있다.
```

## 4. SQL문실행하기

> Statement 객체가 가진 execute를 통해 원하는 Sql문을 실행한다.

* Statement에 있는 모든 execute관련 메서드들은 모두 SQL 실행과 관련된 메서드이다.

  ※ 자세한 건 [API문서](https://docs.oracle.com/javase/8/docs/api/)를 참고하자

```java
String sql = "원하는 Sql 명령문 입력";

int result = stmt.executeUpdate(sql);
System.out.println(result + "개 행이 삽입 성공");
// executeUpdate() 메서드의 리턴값은 boolean형이다
```

## 5. 결과처리

## 6. 자원반납